{"ast":null,"code":"import axios from 'axios';\nimport store from '@/store';\nimport router from '@/router';\n\n// Create axios instance\nconst baseURL = process.env.VUE_APP_API_URL || 'http://localhost:3000/api';\nconst instance = axios.create({\n  baseURL,\n  timeout: 10000,\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\n\n// Request interceptor for API calls\ninstance.interceptors.request.use(config => {\n  const token = store.state.token;\n  console.log('Axios: Request interceptor - Token:', token);\n  if (token) {\n    config.headers['Authorization'] = `Bearer ${token}`;\n    console.log('Axios: Request interceptor - Headers:', config.headers);\n  }\n  return config;\n}, error => {\n  store.commit('setLoading', false);\n  return Promise.reject(error);\n});\n\n// Response interceptor for API calls\ninstance.interceptors.response.use(response => {\n  console.log('Axios: Response interceptor:', {\n    status: response.status,\n    data: response.data,\n    headers: response.headers\n  });\n\n  // Check if response has data\n  if (!response.data) {\n    console.error('Axios: No data in response');\n    return Promise.reject(new Error('No data received from server'));\n  }\n\n  // Return the response data\n  return response.data;\n}, error => {\n  console.error('Axios: Response error:', {\n    status: error.response?.status,\n    data: error.response?.data,\n    message: error.message,\n    config: {\n      url: error.config?.url,\n      method: error.config?.method,\n      headers: error.config?.headers\n    }\n  });\n  const originalRequest = error.config;\n\n  // If the error response is 401 (Unauthorized) and not a retry\n  if (error.response && error.response.status === 401 && !originalRequest._retry) {\n    originalRequest._retry = true;\n\n    // If the path isn't login or auth-related, logout the user\n    if (!originalRequest.url.includes('login') && !originalRequest.url.includes('auth')) {\n      store.dispatch('logout');\n      router.push('/login');\n      store.commit('setNotification', {\n        type: 'error',\n        message: 'Your session has expired. Please log in again.'\n      });\n    }\n  }\n\n  // Show user-friendly error message\n  if (error.response && error.response.data && error.response.data.message) {\n    store.commit('setNotification', {\n      type: 'error',\n      message: error.response.data.message\n    });\n  } else {\n    store.commit('setNotification', {\n      type: 'error',\n      message: 'An error occurred. Please try again later.'\n    });\n  }\n  store.commit('setLoading', false);\n  return Promise.reject(error);\n});\n\n// Plugin\nexport default {\n  install(Vue) {\n    Vue.prototype.$axios = instance;\n  }\n};\nexport const api = instance;","map":{"version":3,"names":["axios","store","router","baseURL","process","env","VUE_APP_API_URL","instance","create","timeout","headers","interceptors","request","use","config","token","state","console","log","error","commit","Promise","reject","response","status","data","Error","message","url","method","originalRequest","_retry","includes","dispatch","push","type","install","Vue","prototype","$axios","api"],"sources":["C:/Users/pmake/OneDrive - Thomas More/Desktop/Web Programming/Final/project/frontend/src/plugins/axios.js"],"sourcesContent":["import axios from 'axios'\r\nimport store from '@/store'\r\nimport router from '@/router'\r\n\r\n// Create axios instance\r\nconst baseURL = process.env.VUE_APP_API_URL || 'http://localhost:3000/api'\r\n\r\nconst instance = axios.create({\r\n  baseURL,\r\n  timeout: 10000,\r\n  headers: {\r\n    'Content-Type': 'application/json'\r\n  }\r\n})\r\n\r\n// Request interceptor for API calls\r\ninstance.interceptors.request.use(\r\n  config => {\r\n    const token = store.state.token\r\n    console.log('Axios: Request interceptor - Token:', token)\r\n    if (token) {\r\n      config.headers['Authorization'] = `Bearer ${token}`\r\n      console.log('Axios: Request interceptor - Headers:', config.headers)\r\n    }\r\n    return config\r\n  },\r\n  error => {\r\n    store.commit('setLoading', false)\r\n    return Promise.reject(error)\r\n  }\r\n)\r\n\r\n// Response interceptor for API calls\r\ninstance.interceptors.response.use(\r\n  response => {\r\n    console.log('Axios: Response interceptor:', {\r\n      status: response.status,\r\n      data: response.data,\r\n      headers: response.headers\r\n    })\r\n    \r\n    // Check if response has data\r\n    if (!response.data) {\r\n      console.error('Axios: No data in response')\r\n      return Promise.reject(new Error('No data received from server'))\r\n    }\r\n    \r\n    // Return the response data\r\n    return response.data\r\n  },\r\n  error => {\r\n    console.error('Axios: Response error:', {\r\n      status: error.response?.status,\r\n      data: error.response?.data,\r\n      message: error.message,\r\n      config: {\r\n        url: error.config?.url,\r\n        method: error.config?.method,\r\n        headers: error.config?.headers\r\n      }\r\n    })\r\n    \r\n    const originalRequest = error.config\r\n    \r\n    // If the error response is 401 (Unauthorized) and not a retry\r\n    if (error.response && error.response.status === 401 && !originalRequest._retry) {\r\n      originalRequest._retry = true\r\n      \r\n      // If the path isn't login or auth-related, logout the user\r\n      if (!originalRequest.url.includes('login') && !originalRequest.url.includes('auth')) {\r\n        store.dispatch('logout')\r\n        router.push('/login')\r\n        \r\n        store.commit('setNotification', {\r\n          type: 'error',\r\n          message: 'Your session has expired. Please log in again.'\r\n        })\r\n      }\r\n    }\r\n    \r\n    // Show user-friendly error message\r\n    if (error.response && error.response.data && error.response.data.message) {\r\n      store.commit('setNotification', {\r\n        type: 'error',\r\n        message: error.response.data.message\r\n      })\r\n    } else {\r\n      store.commit('setNotification', {\r\n        type: 'error',\r\n        message: 'An error occurred. Please try again later.'\r\n      })\r\n    }\r\n    \r\n    store.commit('setLoading', false)\r\n    return Promise.reject(error)\r\n  }\r\n)\r\n\r\n// Plugin\r\nexport default {\r\n  install(Vue) {\r\n    Vue.prototype.$axios = instance\r\n  }\r\n}\r\n\r\nexport const api = instance"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}